## **3. Ensuring data protection (~23%)**
### **3.1 Protecting sensitive data and preventing data loss. Considerations include:**
#### **3.1.1 Configuring Sensitive Data Protection (SP) (e.g., discovering and redacting personally identifiable information (PII), configuring pseudonymization and format preserving encryption)**
Sensitive Data Protection helps to discover, classify and de-identify sensitive data:

-   Discovery: The discovery service creates profiles for the data in your organization
-   Inspection: The inspection service makes a deep scan of individual resources to find instances of sensitive data by specifying an infoType. The service makes a report of every instance of data that matches the infoType (credit cards, etc.).
-   Data de-identification: allows to obfuscate sensitive data. There are several methods:

    -   Redaction: deletes parts or all the detected sensitive data
    -   Replacement: replaces with specified data
    -   Masking: replaces a number of characters with a specified character, for example “*”
    -   Crypto-based tokenization (pseudonymization): encrypts the data. It includes methods for re-identifying (content.reidentify) encrypted sensitive data. Format Preserving Encryption generates an encrypted value using the same alphabet and length of the input value to not disrupt validations.

        -   Deterministic encryption AES
        -   Format Preserving Encryption:
        -   Cryptographic Hashing HMAC-SHA256

    -   Bucketing: generalizes a sensitive value replacing it with a range of values, for example, ages, temperatures, etc.
      -   Date shifting: shifts sensitive date values by a random amount of time
        -   Time extraction: extracts o preserves portions of date/time values

#### **3.1.2 Restricting access to Google Cloud data services (e.g., BigQuery, Cloud Storage, and Cloud SQL datastores)**

As storage services may include data which need to be secured and audited, it is important to set a governance on the data. The priorities are:

Access control:

-   Use IAM roles to control who is accessing storage resources like BQ
-   Set column-level or row-level access control to restrict access in a table to protect sensitive data from unauthorized access
-   Set VPC service controls to set a perimeter around resources containing sensitive data
-   Review and audit audit logs

Data stewardship:

-   Data masking to obscure sensitive data in a table
-   Encryption at rest and in transit
-   Use metadata to tag resources for managing purposes

Data quality:

-   Data lineage to track the flow of the data over time
-   Data profile scans to analyze characteristics of the data
-   Data quality scans to perform data checks and validations over rules

#### **3.1.3 Securing secrets with Secret Manager**
Secret and credential management service which lets you to store and manage sensitive data like API keys, usernames, passwords, etc. This is called a secret, but the actual value of the secret is stored in the secret version. With secret manager you can:
-   Manage rollback, recovery and auditing secret versions
-   Encrypt the secret at rest and in transit
-   Manage access to secrets with IAM roles and conditions
-   Auto rotation of secrets
-   Enforce secret residency

#### **3.1.2 Protecting and managing compute instance metadata**
VM metadata is stored in a metadata server to which the VM has access without authorization. It is useful for startup/shutdown scripts, maintenance, etc. Can be secured using authentication tokens.
### **3.2 Managing encryption at rest, in transit, and in use. Considerations include:**
#### **Identifying use cases for Google default encryption, customer-managed encryption keys (CMEK), and Cloud External Key Manager (EKM)**
Cloud KMS (Key Management Service) provides key management services in Google Cloud for key encryption at rest. Every data in Google Cloud is encrypted at rest, but with KMS it is encrypted at rest and you can manage how encryption keys are managed. Types of keys with their uses cases:
-   Default encryption: every data encrypted using AES-256. Google generates and manages encryption keys to which customers do not have access to.
-   Cloud KMS with sw protected keys: when you want to manage how encryption is performed (symmetric or asymmetric)
-   Cloud KMS with hw protected keys (Cloud HSM): you need keys to be stored in hardware security models of Google using FIPS 140-2 Lvl. 3
-   Cloud KMS with key import: satisfy BYOK that are generated by yourself
-   Cloud KMs with external key manager (Cloud EKM): when you need to create and control keys that are stored in a key manager which is external to Google

Normally Google manages the keys, but CMEK lets you generate, use, rotate and destroy encryption keys, which provides greater control. There is another feature called CSEK (Customer Supplied Encryption Key) which lets you supply your own encryption keys used by Google to encrypt/decrypt the data in BQ or CS. This is risky as you have to fully control all the key lifecycle. If you lose the key, you won’t be able to decrypt the encrypted data.

Envelope encryption: the CMEK is a KEK used to encrypt DEKs
#### **Determining when to use software and hardware keys**
Software keys are used generally to encrypt data in most scenarios such as applications, API keys, and general data protection. When you need to use a robust encryption with high security and you also need to meet compliance requirements. Hardware keys also offer a better performance and provides isolation, as there is physical separation. They are commonly used to encrypt sensitive data like financial data, healthcare records, etc.
#### **Creating and managing encryption keys for CMEK and EKM (e.g., key rotation and revocation, key import)**
Key Rotation:
-   Why key rotation?: to comply with security standards, avoid cryptanalysis
-   How often?: regularly. The recommended practice is to set automatic and periodic rotation at a defined period, for example, 90 days. In case you suspect a key has been compromised, rotate it manually, disable the previous one and revoke access to it ASAP.
-   How does it work?: when you rotate a key, a new version of the key is created. However, previous key version remain active and the data that was encrypted with previous versions is not re-encrypted.

Key rotation process:
1.  Create the new key for the service account
2.  Replace the old key for the new one across all apps
3.  Delete the old key

Key Revocation: when you suspect a key has been compromised, you must rotate the key to create a new version of the key, disable the key version compromised and revoke access to it, so no-one can access it and use it.
#### **Applying encryption methods to various use cases**
**CMEK:** use when you need to own your keys and control key lifecycle. It is compatible with most Google Cloud services
**CSEK:** use when you need to use your own keys generated and managed outside Google. Only compatible with Cloud Storage and Compute Engine
#### **Configuring object lifecycle policies for Cloud Storage**
This feature allows to set a TTL for objects, retaining non current versions of objects and downgrading storage classes to decrease costs. You set this at bucket level and it is made based on a series of rules to apply to actual and future objects in the bucket. For example: downgrading the storage class to objects older than a year, delete objects created before a time, or keeping just the 3 most recent versions of each object. Each rule contains an action and one or more conditions, and to apply the rule, the object must match all conditions.

You should test your rules in DEV but you can also do it in PROD by using matchesPrefix or matchesSuffix conditions in rules. The lifecycle actions are:

-   Delete
-   SetStorageClass: to downgrade storage class
-   AbortIncompleteMultipartUpload: abort when incomplete multipart upload

Bucket Lock
This feature allows to configure bucket retention policy, which means how long objects must be retained. If lock in the policy is enabled, it permanently prevents from altering the policy to be reduced or removed.
#### **Enabling Confidential Computing**
Confidential VMs are a type of Compute Engine VMs using hardware based memory encryption so data and applications cannot be read or modified while being used. They provide isolation as encrypted keys reside in dedicated hardware and attestation, as you can verify the identity and state of the VM, known as Trusted Execution Environment. Once a VM is created, it cannot be migrated to confidential, so you must set it when creating the instance.

Shielded VM: This feature enables to have Virtual Machines whose integrity has been validated in the boot or kernel level. It can be achieved through these features:

-   Secure Boot: it ensures that the system is only running authentic software by verifying the digital signature of all the components
-   Virtual Trusted Platform Module (vTPM): using BoringSSL, it enables through Measured Boot to verify the integrity of objects like keys, certificates, etc.
-   Integrity Monitoring: this relies on the measures created by Measured Boot to check and monitor the integrity of components.
### **3.3 Securing Al workloads. Considerations include:**
#### **Implementing security and privacy controls for Al/ML systems to protect against unintentional exploitation of data or models**

-   Data security:

-   Do not keep data that is not necessary for business. If possible, anonymize data.
-   Monitor all stages of data: collection, storage and transformation.
-   Implement role-based access control to data
-   Implement data encryption, secure perimeters

-   Pipelines security:

-   Use secure coding practices like dependency management, validation, sanitization during model development to avoid vulnerabilities.
-   Protect pipelines and code artifacts from unauthorized access using access-level based on roles
-   Enforce lineage and tracking assets

-   Secure Deployment: ensure the code and models run in secure environments with robust access control. Use prebuilt AI container images
-   Protect and Monitor inputs: monitor the outputs, evaluate performance and implement alerting

#### **Determining security requirements for laaS-hosted and PaaS-hosted training models**
Same as all shared responsibility model services
#### **Implementing security controls for Vertex Al**
VertexAI is a fully managed platform that helps building, deploying and scaling ML and AI applications. So that, it is very important to implement robust security controls. The most important ones are:

-   Data residency at rest
-   Uses CMEK to encrypt data
-   Use VPC Service Controls to set a secure perimeter
-   Access Transparency: logging when Google personnel access your data

These are only for VertexAI Platform, VertexAI RAG Engine only support VPC Service Controls.